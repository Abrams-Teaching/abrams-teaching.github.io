<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>The Metropolis Monte Carlo Method</TITLE>
<META NAME="description" CONTENT="The Metropolis Monte Carlo Method">
<META NAME="keywords" CONTENT="msim">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="msim.css">

<LINK REL="next" HREF="node9.html">
<LINK REL="previous" HREF="node7.html">
<LINK REL="up" HREF="node7.html">
<LINK REL="next" HREF="node9.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html215"
  HREF="node9.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html213"
  HREF="node7.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html207"
  HREF="node7.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html216"
  HREF="node9.html">Case Study 1: The</A>
<B> Up:</B> <A NAME="tex2html214"
  HREF="node7.html">Monte Carlo Simulation</A>
<B> Previous:</B> <A NAME="tex2html208"
  HREF="node7.html">Monte Carlo Simulation</A>
<BR>
<BR>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION00031000000000000000"></A>
<A NAME="sec:metropolis"></A>
<BR>
The Metropolis Monte Carlo Method
</H2>

<P>
Monte Carlo is in general a technique for performing numerical
integration.  Consider the following integral:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
I = \int_a^b f\left(x\right) dx
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="108" HEIGHT="46" BORDER="0"
 SRC="img183.png"
 ALT="\begin{displaymath}
I = \int_a^b f\left(x\right) dx
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(57)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
Now imagine that we have a second function, <IMG
 WIDTH="34" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img184.png"
 ALT="$\rho(x)$">, which is positive
in the interval <IMG
 WIDTH="35" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img185.png"
 ALT="$[a,b]$">.  We can also express <IMG
 WIDTH="12" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img186.png"
 ALT="$I$"> as
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
I = \int_a^b \frac{f\left(x\right)}{\rho\left(x\right)}\rho\left(x\right) dx
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="144" HEIGHT="47" BORDER="0"
 SRC="img187.png"
 ALT="\begin{displaymath}
I = \int_a^b \frac{f\left(x\right)}{\rho\left(x\right)}\rho\left(x\right) dx
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(58)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
If we think of <!-- MATH
 $\rho\left(x\right)$
 -->
<IMG
 WIDTH="36" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img188.png"
 ALT="$\rho\left(x\right)$"> as a <EM>probability density</EM>,
then what we have just expressed is the average of the quantity
<IMG
 WIDTH="30" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img189.png"
 ALT="$f/\rho$"> on <IMG
 WIDTH="28" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$rho$"> in the interval <IMG
 WIDTH="35" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img185.png"
 ALT="$[a,b]$">:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
I = \left<\frac{f\left(x\right)}{\rho\left(x\right)}\right>_\rho
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="97" HEIGHT="48" BORDER="0"
 SRC="img190.png"
 ALT="\begin{displaymath}
I = \left&lt;\frac{f\left(x\right)}{\rho\left(x\right)}\right&gt;_\rho
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(59)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
This implies that we can approximate <IMG
 WIDTH="12" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img186.png"
 ALT="$I$"> by picking <IMG
 WIDTH="21" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img8.png"
 ALT="$M$"> values <!-- MATH
 $\left\{x_i\right\}$
 -->
<IMG
 WIDTH="34" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img191.png"
 ALT="$\left\{x_i\right\}$"> randomly out of the probability distribution <IMG
 WIDTH="34" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img184.png"
 ALT="$\rho(x)$"> and computing
the following sum:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
I \approx \frac{1}{M} \sum_{i=1}^{M} \frac{f\left(x_i\right)}{\rho\left(x_i\right)}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="120" HEIGHT="56" BORDER="0"
 SRC="img192.png"
 ALT="\begin{displaymath}
I \approx \frac{1}{M} \sum_{i=1}^{M} \frac{f\left(x_i\right)}{\rho\left(x_i\right)}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(60)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
Note that this approximates the mean of <IMG
 WIDTH="30" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img189.png"
 ALT="$f/\rho$"> as long as pick a
large enough number of random numbers (<IMG
 WIDTH="21" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img8.png"
 ALT="$M$"> is large enough) such that
we ``densely'' cover the interval <IMG
 WIDTH="35" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img185.png"
 ALT="$[a,b]$">.  If <!-- MATH
 $\rho\left(x\right)$
 -->
<IMG
 WIDTH="36" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img188.png"
 ALT="$\rho\left(x\right)$"> is
<EM>uniform</EM> on <IMG
 WIDTH="35" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img185.png"
 ALT="$[a,b]$">,
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\rho\left(x\right) = \frac{1}{b-a},\ \ \ a < x < b
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="182" HEIGHT="40" BORDER="0"
 SRC="img193.png"
 ALT="\begin{displaymath}
\rho\left(x\right) = \frac{1}{b-a},   a &lt; x &lt; b
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(61)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
and therefore,
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
I \approx \frac{a-b}{M} \sum_{i=1}^{M} f\left(x_i\right)
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:unif_avg"></A><IMG
 WIDTH="133" HEIGHT="56" BORDER="0"
 SRC="img194.png"
 ALT="\begin{displaymath}
I \approx \frac{a-b}{M} \sum_{i=1}^{M} f\left(x_i\right)
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(62)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>
The next question is, how good an approximation is this, compared with
more traditional one-dimensional numerical integration techniques,
such as Simpson's rule and quadrature?  A better phrasing of this
question is, how expensive is this technique for a given level of
accuracy, compared to traditional techniques?  Consider this means to
compute <IMG
 WIDTH="14" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img195.png"
 ALT="$\pi$">:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\frac{\pi}{4} = \int_0^1 \left(1-x^2\right)^{1/2}dx
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:get_pi"></A><IMG
 WIDTH="157" HEIGHT="46" BORDER="0"
 SRC="img196.png"
 ALT="\begin{displaymath}
\frac{\pi}{4} = \int_0^1 \left(1-x^2\right)^{1/2}dx
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(63)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
Allen and Tildesley&nbsp;[<A
 HREF="node63.html#Allen+Tildesley1987">2</A>] mention that, in order
use Eq.&nbsp;<A HREF="#eq:unif_avg">62</A> to compute <IMG
 WIDTH="14" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img195.png"
 ALT="$\pi$"> to an accuracy of one part
in 10<IMG
 WIDTH="11" HEIGHT="18" ALIGN="BOTTOM" BORDER="0"
 SRC="img28.png"
 ALT="$^6$"> requires <IMG
 WIDTH="21" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img8.png"
 ALT="$M$">&nbsp;=&nbsp;10<IMG
 WIDTH="11" HEIGHT="18" ALIGN="BOTTOM" BORDER="0"
 SRC="img197.png"
 ALT="$^7$"> random values of <IMG
 WIDTH="18" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img198.png"
 ALT="$x_i$">, whereas
Simpson's rule required <EM>three orders of magnitude</EM> fewer points
to discretize the interval to obtain an accuracy of one part in
10<IMG
 WIDTH="11" HEIGHT="18" ALIGN="BOTTOM" BORDER="0"
 SRC="img197.png"
 ALT="$^7$">.  So the answer is, integral estimation using uniform random
variates is expensive.

<P>
But, the situation changes radically when the dimensionality of the
integral is large, as is the case for an ensemble average.  For
example, for 100 particles having 300 coordinates, the configurational
average <!-- MATH
 $\left<G\right>$
 -->
<IMG
 WIDTH="29" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img54.png"
 ALT="$\left&lt;G\right&gt;$"> (Eq.&nbsp;<A HREF="node6.html#eq:config_avg">54</A>) could be
discretized using Simpson's rule.  If we did that, requesting only a
modest 10 points per axis in configurational space, we would need to
evaluate the integrand <!-- MATH
 $Ge^{-\beta\mathscr{U}}$
 -->
<IMG
 WIDTH="52" HEIGHT="20" ALIGN="BOTTOM" BORDER="0"
 SRC="img199.png"
 ALT="$Ge^{-\beta\mathscr{U}}$">
<BLOCKQUOTE>
10<IMG
 WIDTH="24" HEIGHT="18" ALIGN="BOTTOM" BORDER="0"
 SRC="img200.png"
 ALT="$^{300}$">
</BLOCKQUOTE>
times.  This is an almost unimaginably large number (a googul cubed).
Using a direct numerical technique to compute statistical mechanical
averages is simply out of the question.

<P>
We therefore return to the idea of evaluating the integrand at a
discrete set of points selected randomly from a distribution.  Here we
call upon the idea of <EM>importance sampling</EM>.  Let us try to use
whatever we know ahead of time about the integrand in picking our
random distribution, <IMG
 WIDTH="28" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$rho$">, such that we <EM>minimize</EM> the number of
points (i.e., the expense) necessary to give an estimate of
<!-- MATH
 $\left<G\right>$
 -->
<IMG
 WIDTH="29" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img54.png"
 ALT="$\left&lt;G\right&gt;$"> to a given level of accuracy.

<P>
Now, clearly the states that contribute the most to the integrals we
wish to evaluate by configurational averaging are those states with
large Boltzmann factors; that is, those states for which <IMG
 WIDTH="44" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img180.png"
 ALT="$\rho_{NVT}$">
is large.  It stands to reason that if we randomly select points from
<IMG
 WIDTH="44" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img180.png"
 ALT="$\rho_{NVT}$">, we will do a pretty good job approximating the integral.
So what we end up computing is the ``average of <IMG
 WIDTH="56" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img201.png"
 ALT="$G\rho_{NVT}$"> over
<IMG
 WIDTH="44" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img180.png"
 ALT="$\rho_{NVT}$">'':
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\left<G\rho_{NVT}/\rho_{NVT}\right> \approx \left<G\right>,
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="163" HEIGHT="28" BORDER="0"
 SRC="img202.png"
 ALT="\begin{displaymath}
\left&lt;G\rho_{NVT}/\rho_{NVT}\right&gt; \approx \left&lt;G\right&gt;,
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(64)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
which should give an excellent approximation for <!-- MATH
 $\left<G\right>$
 -->
<IMG
 WIDTH="29" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img54.png"
 ALT="$\left&lt;G\right&gt;$">.
The idea of using the <IMG
 WIDTH="44" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img180.png"
 ALT="$\rho_{NVT}$"> as the sampling distribution is due
to Metropolis et al.&nbsp;[<A
 HREF="node63.html#Metropolis1953">6</A>].  This makes the real work
in computing <!-- MATH
 $\left<G\right>$
 -->
<IMG
 WIDTH="29" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img54.png"
 ALT="$\left&lt;G\right&gt;$"> generating states that randomly sample
<IMG
 WIDTH="44" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img180.png"
 ALT="$\rho_{NVT}$">.

<P>
Metropolis et al.&nbsp;[<A
 HREF="node63.html#Metropolis1953">6</A>] showed that an efficient way to
do this involves generating a <EM>Markov chain of states</EM> which is
constructed such that its limiting distribution is <IMG
 WIDTH="44" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img180.png"
 ALT="$\rho_{NVT}$">.  A
Markov chain is just a sequence of trials, where (i) each trial
outcome is a member of a finite set called ``state space,'' and (ii)
every trial outcome depends only on the outcome that immediately
precedes it.  By ``limiting distribution,'' we mean that the trial
acceptance probabilities are tuned such that the probability of
observing the Markov chain atop a particular state is defined by some
equilibrium probability distribution, <IMG
 WIDTH="28" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$rho$">.  For the following
discussion, it will be convenient to denote a particular state <IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img203.png"
 ALT="$n$">
using <IMG
 WIDTH="22" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img204.png"
 ALT="$\Gamma_n$">, instead of <IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img56.png"
 ALT="$\nu$">.

<P>
A trial is some perturbation (usually small) of the coordinates
specifying a state.  For example, in an Ising system, this might mean
flipping a randomly selected spin.  In a system of particles in
continuous space, it might mean displacing a randomly selected
particle by a small amount <IMG
 WIDTH="19" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img205.png"
 ALT="$\delta r$"> in a randomly chosen direction.
There is a large variety of such ``trial moves'' for any particular
system; we will only deal with a few simple ones in this course.

<P>
The probability that a trial move results in a successful transition
from state <IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img203.png"
 ALT="$n$"> to <IMG
 WIDTH="18" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img76.png"
 ALT="$m$"> is denoted <IMG
 WIDTH="33" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img206.png"
 ALT="$\pi_{nm}$"> and <IMG
 WIDTH="14" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img207.png"
 ALT="${\bf\pi}$"> is called
the ``transition matrix.''  It must be specified ahead of time to
execute a traditional Markov chain.  Since the probability that a
trial results in a successful transition to any state, the rows
of <IMG
 WIDTH="14" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img207.png"
 ALT="${\bf\pi}$"> add to unity:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\sum_i \pi_{ni} = 1
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="76" HEIGHT="44" BORDER="0"
 SRC="img208.png"
 ALT="\begin{displaymath}
\sum_i \pi_{ni} = 1
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(65)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
With this specification, we term <IMG
 WIDTH="14" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img207.png"
 ALT="${\bf\pi}$"> a ``stochastic'' matrix.
Furthermore, for an equilibrium ensemble of states in state space, we
require that transitions from state to state <EM>do not alter state
weights</EM> as determined by the limiting distribution.  So the weight of
state <IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img203.png"
 ALT="$n$">:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\rho_n \equiv \rho_{NVT}\left(\Gamma_n\right)
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="109" HEIGHT="28" BORDER="0"
 SRC="img209.png"
 ALT="\begin{displaymath}
\rho_n \equiv \rho_{NVT}\left(\Gamma_n\right)
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(66)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
must be the result of transitions from all other states to state <IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img203.png"
 ALT="$n$">:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\rho_n = \sum_m \rho_m \pi_{mn}.
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:flow"></A><IMG
 WIDTH="116" HEIGHT="44" BORDER="0"
 SRC="img210.png"
 ALT="\begin{displaymath}
\rho_n = \sum_m \rho_m \pi_{mn}.
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(67)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>
For all states <IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img203.png"
 ALT="$n$">, we can write Eq.&nbsp;<A HREF="#eq:flow">67</A> as a post-op matrix
equation:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
{\bf\rho\pi} = {\bf\rho}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:balance"></A><IMG
 WIDTH="47" HEIGHT="27" BORDER="0"
 SRC="img211.png"
 ALT="\begin{displaymath}
{\bf\rho\pi} = {\bf\rho}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(68)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
where <IMG
 WIDTH="12" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img212.png"
 ALT="${\bf\rho}$"> is the row vector of all state weights.
Eq.&nbsp;<A HREF="#eq:balance">68</A> constrains our choice of <IMG
 WIDTH="14" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img207.png"
 ALT="${\bf\pi}$">.  This means
there is still more than one way to specify <IMG
 WIDTH="12" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img212.png"
 ALT="${\bf\rho}$">.  Metropolis
et al.&nbsp;[<A
 HREF="node63.html#Metropolis1953">6</A>] suggested:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\rho_m\pi_{mn} = \rho_n\pi_{nm}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:detailed_balance"></A><IMG
 WIDTH="115" HEIGHT="27" BORDER="0"
 SRC="img213.png"
 ALT="\begin{displaymath}
\rho_m\pi_{mn} = \rho_n\pi_{nm}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(69)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
That is, the probability of transitioning from state <IMG
 WIDTH="18" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img76.png"
 ALT="$m$"> to <IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img203.png"
 ALT="$n$"> is
exactly equal to the probability of transitioning from state <IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img203.png"
 ALT="$n$"> to
<IMG
 WIDTH="18" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img76.png"
 ALT="$m$">.  This is called the ``detailed balance'' condition, and it
guarantees that the state weights remain static.  Observe:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\sum_m \rho_m\pi_{mn} = \sum_m\left(\rho_n\pi_{nm}\right) = \rho_n\left(\sum_m\pi_{nm}\right) = \rho_n
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="338" HEIGHT="54" BORDER="0"
 SRC="img214.png"
 ALT="\begin{displaymath}
\sum_m \rho_m\pi_{mn} = \sum_m\left(\rho_n\pi_{nm}\right) = \rho_n\left(\sum_m\pi_{nm}\right) = \rho_n
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(70)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
Detailed balance is, however, overly restrictive; this fact is of
little importance in this course.

<P>
Metropolis et al.&nbsp;[<A
 HREF="node63.html#Metropolis1953">6</A>] chose to construct <IMG
 WIDTH="14" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img207.png"
 ALT="${\bf\pi}$"> as
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\pi_{nm} = \alpha_{nm} {\rm acc}\left(n\rightarrow m\right)
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="164" HEIGHT="28" BORDER="0"
 SRC="img215.png"
 ALT="\begin{displaymath}
\pi_{nm} = \alpha_{nm} {\rm acc}\left(n\rightarrow m\right)
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(71)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
where <IMG
 WIDTH="14" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img36.png"
 ALT="$\alpha $"> is the probability that a trial move is attempted, and
<IMG
 WIDTH="26" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img216.png"
 ALT="${\rm acc}$"> is the probability that a move is accepted.  If the
probability of <EM>proposing</EM> a move from <IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img203.png"
 ALT="$n$"> to <IMG
 WIDTH="18" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img76.png"
 ALT="$m$"> is equal to that
of <EM>proposing</EM> a move from <IMG
 WIDTH="18" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img76.png"
 ALT="$m$"> to <IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img203.png"
 ALT="$n$">, then <!-- MATH
 $\alpha_{nm} =
\alpha_{mn}$
 -->
<IMG
 WIDTH="85" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img217.png"
 ALT="$\alpha_{nm} =
\alpha_{mn}$">, and the detailed balance condition is written:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\rho_n{\rm acc}\left(n\rightarrow m\right) =
\rho_m{\rm acc}\left(m\rightarrow n\right)
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="227" HEIGHT="28" BORDER="0"
 SRC="img218.png"
 ALT="\begin{displaymath}
\rho_n{\rm acc}\left(n\rightarrow m\right) =
\rho_m{\rm acc}\left(m\rightarrow n\right)
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(72)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
from which follows
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\frac{{\rm acc}\left(n\rightarrow m\right)}{{\rm acc}\left(m\rightarrow n\right)} =
\frac{\rho_m}{\rho_n} = 
\frac{e^{-\beta\mathscr{U}\left(\Gamma_m\right)}}{e^{-\beta\mathscr{U}\left(\Gamma_n\right)}}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="221" HEIGHT="46" BORDER="0"
 SRC="img219.png"
 ALT="\begin{displaymath}
\frac{{\rm acc}\left(n\rightarrow m\right)}{{\rm acc}\left(m...
...(\Gamma_m\right)}}{e^{-\beta\mathscr{U}\left(\Gamma_n\right)}}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(73)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
giving
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\frac{{\rm acc}\left(n\rightarrow m\right)}{{\rm acc}\left(m\rightarrow n\right)} =
\exp\left\{-\beta\left[\mathscr{U}\left(\Gamma_m\right)-\mathscr{U}\left(\Gamma_n\right)\right]\right\} \equiv \exp\left(-\beta\Delta\mathscr{U}_{nm}\right)
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:acc"></A><IMG
 WIDTH="424" HEIGHT="44" BORDER="0"
 SRC="img220.png"
 ALT="\begin{displaymath}
\frac{{\rm acc}\left(n\rightarrow m\right)}{{\rm acc}\left(m...
...]\right\} \equiv \exp\left(-\beta\Delta\mathscr{U}_{nm}\right)
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(74)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
where we have defined the change in potential energy as
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\Delta\mathscr{U}_{nm} = \mathscr{U}\left(\Gamma_m\right)-\mathscr{U}\left(\Gamma_n\right)
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="177" HEIGHT="28" BORDER="0"
 SRC="img221.png"
 ALT="\begin{displaymath}
\Delta\mathscr{U}_{nm} = \mathscr{U}\left(\Gamma_m\right)-\mathscr{U}\left(\Gamma_n\right)
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(75)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>

<P>
There are many choices for <!-- MATH
 ${\rm acc}\left(n \rightarrow m\right)$
 -->
<IMG
 WIDTH="89" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img222.png"
 ALT="${\rm acc}\left(n \rightarrow m\right)$">
that satisfy Eq.&nbsp;<A HREF="#eq:acc">74</A>. The original choice of Metropolis is
used most frequently:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
{\rm acc}\left(n \rightarrow m\right) = \left\{\begin{array}{ll}
	\exp\left(-\beta\Delta\mathscr{U}_{nm}\right) & \Delta\mathscr{U}_{nm} > 0\\
	1 & \Delta\mathscr{U}_{nm} < 0
	\end{array}
	\right.
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="321" HEIGHT="45" BORDER="0"
 SRC="img223.png"
 ALT="\begin{displaymath}
{\rm acc}\left(n \rightarrow m\right) = \left\{\begin{array}...
...m} &gt; 0\\
1 &amp; \Delta\mathscr{U}_{nm} &lt; 0
\end{array} \right.
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(76)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
So, suppose we have some initial configuration <IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img203.png"
 ALT="$n$"> with potential
energy <IMG
 WIDTH="23" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img224.png"
 ALT="$U_n$">.  We make a trial move, <EM>temporarily</EM> generating a
new configuration <IMG
 WIDTH="18" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img76.png"
 ALT="$m$">.  Now we calculate a new energy, <IMG
 WIDTH="27" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img225.png"
 ALT="$U_m$">.  If this
energy is lower than the original, (<IMG
 WIDTH="68" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img226.png"
 ALT="$U_m &lt; U_n$">) we unconditionally
accept the move, and configuration <IMG
 WIDTH="18" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img76.png"
 ALT="$m$"> becomes the <EM>current</EM>
configuration.  If it is greater than the original, (<IMG
 WIDTH="68" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img227.png"
 ALT="$U_m &gt; U_n$">) we
accept it with a probability consistent with the fact that the states
both belong to a canonical ensemble.  How does one in practice decide
whether to accept the move?  One first picks a uniform random variate
<IMG
 WIDTH="13" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img47.png"
 ALT="$x$"> on the interval <IMG
 WIDTH="36" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img228.png"
 ALT="$[0,1]$">.  If <!-- MATH
 $x \le {\rm acc}\left(n \rightarrow
m\right)$
 -->
<IMG
 WIDTH="120" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img229.png"
 ALT="$x \le {\rm acc}\left(n \rightarrow
m\right)$">, the move is accepted.

<P>
The next section is devoted to an implementation of the Metropolis
Monte Carlo method for a 2D Ising magnet.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html215"
  HREF="node9.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html213"
  HREF="node7.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html207"
  HREF="node7.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html216"
  HREF="node9.html">Case Study 1: The</A>
<B> Up:</B> <A NAME="tex2html214"
  HREF="node7.html">Monte Carlo Simulation</A>
<B> Previous:</B> <A NAME="tex2html208"
  HREF="node7.html">Monte Carlo Simulation</A>
<!--End of Navigation Panel-->
<ADDRESS>
cfa22@drexel.edu
</ADDRESS>
</BODY>
</HTML>
