<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Case Study 2: Static Properties of the Lennard-Jones Fluid (Case Study 4 in F&amp;S)</TITLE>
<META NAME="description" CONTENT="Case Study 2: Static Properties of the Lennard-Jones Fluid (Case Study 4 in F&amp;S)">
<META NAME="keywords" CONTENT="msim">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="msim.css">

<LINK REL="next" HREF="node29.html">
<LINK REL="previous" HREF="node25.html">
<LINK REL="up" HREF="node21.html">
<LINK REL="next" HREF="node29.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html423"
  HREF="node29.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html421"
  HREF="node21.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html415"
  HREF="node27.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html424"
  HREF="node29.html">Case Study 3: Dynamical</A>
<B> Up:</B> <A NAME="tex2html422"
  HREF="node21.html">Molecular Dynamics Simulation</A>
<B> Previous:</B> <A NAME="tex2html416"
  HREF="node27.html">The Code, mdlj.c</A>
<BR>
<BR>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION00043000000000000000">
Case Study 2:  Static Properties of the Lennard-Jones Fluid (Case Study 4 in F&amp;S)</A>
</H2>

<P>
The code <EM>mdlj.c</EM> was run according to the instructions given in
Case Study 4 in F&amp;S: namely, we have 108 particles on a simple cubic
lattice at a density <IMG
 WIDTH="28" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$rho$"> = 0.8442 and temperature (specified by
velocity assignment and scaling) initially set at <IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.png"
 ALT="$T$"> = 0.728.  A
single run of 600,000 time steps was performed, which took about 10
minutes on my laptop.  (This is about 10<IMG
 WIDTH="11" HEIGHT="18" ALIGN="BOTTOM" BORDER="0"
 SRC="img429.png"
 ALT="$^5$"> particle-updates per
second; not bad for a laptop running a silly <IMG
 WIDTH="26" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img266.png"
 ALT="$N^2$"> pair search, but
it's only for <IMG
 WIDTH="16" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img51.png"
 ALT="$\sim$"> 100 particles...the same algorithm applied to 10,000
would be slower.)
The commands I issued looked like:
<PRE>
cfa@abrams01:/home/cfa/dxu/che800-002&gt;mkdir md_cs2
cfa@abrams01:/home/cfa/dxu/che800-002&gt;cd md_cs2
cfa@abrams01:/home/cfa/dxu/che800-002/md_cs2&gt;../mdlj -N 108 \
	-fs 1000 -ns 600000 -rho 0.8442 -T0 0.728 -rc 2.5 \
	-sf w &gt;&amp; 1.out &amp;
cfa@abrams01:/home/cfa/dxu/che800-002/md_cs2&gt;
</PRE>
The final <TT>&amp;</TT> puts the simulation ``in the background,'' and returns
the shell prompt to you.  You can verify that the job is running
by issuing the ``top'' command, which displays in the terminal the 
a listing of processes using CPU, ranked by how intensively they are
using the CPU.  This command ``takes over'' your terminal to display 
continually updated information, until you hit Ctrl-C. You can also watch
the progress of the job by <TT>tail</TT>'ing your output file, <TT>1.out</TT>:
<PRE>
cfa@abrams01:/home/cfa/dxu/che800-002/md_cs2&gt;tail 1.out
36 -294.14399 61.00381 -233.14018 -8.67332e-05 0.37657 13.60634
37 -293.52976 60.38962 -233.14014 -8.69020e-05 0.37278 13.62074
38 -293.10113 59.96093 -233.14020 -8.66266e-05 0.37013 13.62894
39 -292.85739 59.71704 -233.14035 -8.59752e-05 0.36862 13.62943
40 -292.79605 59.65542 -233.14063 -8.47739e-05 0.36824 13.62458
41 -292.91274 59.77171 -233.14103 -8.30943e-05 0.36896 13.61425
42 -293.20127 60.05973 -233.14154 -8.09009e-05 0.37074 13.59889
43 -293.65399 60.51186 -233.14213 -7.83670e-05 0.37353 13.57847
44 -294.26183 61.11902 -233.14281 -7.54321e-05 0.37728 13.55276
45 -295.01420 61.87068 -233.14352 -7.23805e-05 0.38192 13.52180
</PRE>
The <TT>-f</TT> flag on the <TT>tail</TT> command makes the command display
the file as it is being written.  (This will be demonstrated in
class.)

<P>
From the command line arguments shown above, we can see that this
simulation run will produce 600 snapshots, beginning with <IMG
 WIDTH="39" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img430.png"
 ALT="$t=0$"> and
outputting every 1000 steps.  Each one contains 108 sextuples to eight
decimal places, which is about 65 bytes times 108 = 7 kB.  The actual
file size is about 7.6 kB, which takes into account the repetitive
particle type indices at the beginning of each line.  So, for 600 such
files, we wind up with a requirement of about 4.5 MB.  As few as seven
years ago, one might have raised an eyebrow at this; nowadays, this is
very nearly an insignificant amount of storage (it is roughly 1/1000th
of the space on my laptop's disk).

<P>
After the run finishes, the first thing we can reproduce is Fig.&nbsp;4.3:
<TABLE CELLPADDING=3>
<TR><TD ALIGN="CENTER"><IMG
 WIDTH="280" HEIGHT="252" ALIGN="CENTER"
 SRC="fig4.3.gif"
 ALT="portrait"></TD>
</TR>
<TR><TD ALIGN="CENTER"><TABLE  WIDTH="454">
<TR><TD>
<DIV ALIGN="CENTER">Energy traces for the run described in Case Study 4 in F&amp;S: <IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.png"
 ALT="$T$"> = 0.729, <IMG
 WIDTH="28" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$rho$"> = 0.8442, <IMG
 WIDTH="18" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img2.png"
 ALT="$N$"> = 108.&nbsp;<A NAME="tex2html10"
  HREF="#footmp3965"><SUP>1</SUP></A></DIV></TD></TR>
<TR ALIGN="LEFT">
<TD><DL>
<DD><A NAME="footmp3965"><SUP>1</SUP></A> This graph was produced using gnuplot and
a script found <A NAME="tex2html11"
  HREF="gp/gp43">here</A>.
</DD>
</DL></TD></TR>
</TABLE></TD>
</TR>
</TABLE>
An important purpose of this case study in the text is to quantify the
notion of ``equilibration'' of the system by assessing correlations in
(apparently) randomly fluctuating quantities like potential energy.
Remember, in order to perform accurate ensemble averaging over an MD
trajectory, we have to be sure that correlations in the properties we
are measuring have ``died out.''  This is another way of saying that
the length of the time interval over which we conduct the <EM>time
average</EM> must be much longer than the appropriate correlation time.
In this case study, we illustrate the ``block averaging'' technique of
Flyvbjerg and Petersen (Appendix D3 in F&amp;S) to determine the
equilibration time-scale of the potential energy.

<P>
First, compute the variance of the <IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img39.png"
 ALT="$L$"> samples of <IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img161.png"
 ALT="$\mathscr{U}$">:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\sigma^2_0\left({\mathscr{U}}\right) \approx \frac{1}{L}\sum_{i=1}^{L}\left[\mathscr{U}_i - \bar\mathscr{U}\right]^2
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="173" HEIGHT="56" BORDER="0"
 SRC="img431.png"
 ALT="\begin{displaymath}
\sigma^2_0\left({\mathscr{U}}\right) \approx \frac{1}{L}\sum_{i=1}^{L}\left[\mathscr{U}_i - \bar\mathscr{U}\right]^2
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(149)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
This is approximate because of so far undetermined time-correlations
in <IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img161.png"
 ALT="$\mathscr{U}$">; that is, not all <IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img39.png"
 ALT="$L$"> samples are uncorrelated.  For
example, two samples one time-step apart will likely be very close to
one another.  Now, we block the data by averaging <IMG
 WIDTH="31" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img432.png"
 ALT="$L/2$"> pairs of adjacent
values:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\mathscr{U}_i^{(1)} = \frac{\mathscr{U}_{2i-1} + \mathscr{U}_{2i}}{2}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="133" HEIGHT="39" BORDER="0"
 SRC="img433.png"
 ALT="\begin{displaymath}
\mathscr{U}_i^{(1)} = \frac{\mathscr{U}_{2i-1} + \mathscr{U}_{2i}}{2}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(150)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
The <IMG
 WIDTH="24" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img434.png"
 ALT="$(1)$"> superscript indicates that this is a ``first-generation''
coarsening of the potential energy trace.  The variance of this new
set, <IMG
 WIDTH="21" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img435.png"
 ALT="$\sigma^2_1$"> is computed.  Then the process is recursively
carried out through many subsequent generations.  After many blocking
operations, the coarsened samples, <!-- MATH
 $\mathscr{U}_i^{(j)}$
 -->
<IMG
 WIDTH="32" HEIGHT="43" ALIGN="MIDDLE" BORDER="0"
 SRC="img436.png"
 ALT="$\mathscr{U}_i^{(j)}$">, become
uncorrelated, and the variance saturates (temporarily).  This means we
should observe a plateau in a plot of variance vs generation.

<P>
<TABLE CELLPADDING=3>
<TR><TD ALIGN="CENTER"><IMG
 WIDTH="360" HEIGHT="252" ALIGN="CENTER"
 SRC="fig4.4.gif"
 ALT="portrait"></TD>
</TR>
<TR><TD ALIGN="CENTER"><TABLE  WIDTH="454">
<TR><TD>
<DIV ALIGN="CENTER">The standard deviation, <IMG
 WIDTH="14" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img7.png"
 ALT="$\sigma $">, of potential energy per particle
vs. number of blocking operations <IMG
 WIDTH="21" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img8.png"
 ALT="$M$"> for a simulation of 150,000 and
600,000 as discussed Case Study 4 in F&amp;S: <IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.png"
 ALT="$T$"> = 0.729, <IMG
 WIDTH="28" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$rho$"> =
0.8442, <IMG
 WIDTH="18" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img2.png"
 ALT="$N$"> = 108.&nbsp;<A NAME="tex2html12"
  HREF="#footmp3968"><SUP>1</SUP></A></DIV></TD></TR>
<TR ALIGN="LEFT">
<TD><DL>
<DD><A NAME="footmp3968"><SUP>1</SUP></A> The blocking/averaging was performed with
a utility code <A NAME="tex2html13"
  HREF="codes/flyvbjerg.c">flyvbjerg.c</A>.  This
graph was produced using gnuplot and a script found
<A NAME="tex2html14"
  HREF="gp/gpM">here</A>.
</DD>
</DL></TD></TR>
</TABLE></TD>
</TR>
</TABLE>
According to the discussion of this blocking technique, the standard
deviation shows a dependence on the blocking degree, <IMG
 WIDTH="21" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img8.png"
 ALT="$M$">, when the
blocked averages are correlated, and plateaus at a blocking degree for
which the averages become uncorrelated.  This blocking degree
corresponds to a time interval of length <IMG
 WIDTH="26" HEIGHT="20" ALIGN="BOTTOM" BORDER="0"
 SRC="img437.png"
 ALT="$2^M$">.  This data indicates
that potential energy decorrelates after a time of approximately
<!-- MATH
 $2^{10} \approx 1000$
 -->
<IMG
 WIDTH="78" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img438.png"
 ALT="$2^{10} \approx 1000$">&nbsp;steps.  This is a reassuring result, as we could
have guessed that 1000 steps are required based on the initial
transience in the energy traces seen in the previous figure.  I ran
three indepenendent simulations, each differing only in the random
number seed used.  The results follow.

<P>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT">Run</TD>
<TD ALIGN="LEFT"><!-- MATH
 $\left<\mathscr{U}\right>/N$
 -->
<IMG
 WIDTH="52" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img439.png"
 ALT="$\left&lt;\mathscr{U}\right&gt;/N$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $\left<\mathscr{K}\right>/N$
 -->
<IMG
 WIDTH="54" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img440.png"
 ALT="$\left&lt;\mathscr{K}\right&gt;/N$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $\left<\mathscr{T}\right>$
 -->
<IMG
 WIDTH="26" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img441.png"
 ALT="$\left&lt;\mathscr{T}\right&gt;$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $\left<\mathscr{P}\right>$
 -->
<IMG
 WIDTH="27" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img442.png"
 ALT="$\left&lt;\mathscr{P}\right&gt;$"></TD>
</TR>
<TR><TD ALIGN="LEFT">1</TD>
<TD ALIGN="LEFT"><!-- MATH
 $-4.4165 \pm 0.0012$
 -->
<IMG
 WIDTH="124" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img443.png"
 ALT="$-4.4165 \pm 0.0012$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $2.2577 \pm 0.0012$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img444.png"
 ALT="$2.2577 \pm 0.0012$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $1.5051 \pm 0.0008$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img445.png"
 ALT="$1.5051 \pm 0.0008$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $5.1960 \pm 0.0057$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img446.png"
 ALT="$5.1960 \pm 0.0057$"></TD>
</TR>
<TR><TD ALIGN="LEFT">2</TD>
<TD ALIGN="LEFT"><!-- MATH
 $-4.4188 \pm 0.0010$
 -->
<IMG
 WIDTH="124" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img447.png"
 ALT="$-4.4188 \pm 0.0010$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $2.2597 \pm 0.0010$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img448.png"
 ALT="$2.2597 \pm 0.0010$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $1.5064 \pm 0.0007$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img449.png"
 ALT="$1.5064 \pm 0.0007$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $5.1948 \pm 0.0050$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img450.png"
 ALT="$5.1948 \pm 0.0050$"></TD>
</TR>
<TR><TD ALIGN="LEFT">3</TD>
<TD ALIGN="LEFT"><!-- MATH
 $-4.4157 \pm 0.0011$
 -->
<IMG
 WIDTH="124" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img451.png"
 ALT="$-4.4157 \pm 0.0011$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $2.2564 \pm 0.0011$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img452.png"
 ALT="$2.2564 \pm 0.0011$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $1.5043 \pm 0.0008$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img453.png"
 ALT="$1.5043 \pm 0.0008$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $5.2022 \pm 0.0055$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img454.png"
 ALT="$5.2022 \pm 0.0055$"></TD>
</TR>
<TR><TD ALIGN="LEFT">Avg.</TD>
<TD ALIGN="LEFT"><!-- MATH
 $-4.4170 \pm 0.0011$
 -->
<IMG
 WIDTH="124" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img455.png"
 ALT="$-4.4170 \pm 0.0011$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $2.2579 \pm 0.0011$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img456.png"
 ALT="$2.2579 \pm 0.0011$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $1.5053 \pm 0.0008$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img457.png"
 ALT="$1.5053 \pm 0.0008$"></TD>
<TD ALIGN="LEFT"><!-- MATH
 $5.1977 \pm 0.0054$
 -->
<IMG
 WIDTH="112" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img458.png"
 ALT="$5.1977 \pm 0.0054$"></TD>
</TR>
</TABLE> 

<P>
A second major objective of this case study is to demonstrate how to
compute the radial distribution function, <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$">.  The radial
distribution function is an important statistical mechanical function
that captures the structure of liquids and amorphous solids.  We can
express <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$"> using the following statement:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
\rho g(r) = \mbox{\begin{minipage}{10cm}average density of particles at
${\bf r}$\  given that\\a tagged particle is at the origin\end{minipage}}
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="354" HEIGHT="40" BORDER="0"
 SRC="img460.png"
 ALT="\begin{displaymath}
\rho g(r) = \mbox{\begin{minipage}{10cm}average density of p...
...given that\ a tagged particle is at the origin\end{minipage}}
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(151)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
We can use <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$"> to count particles within a distance <IMG
 WIDTH="12" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img296.png"
 ALT="$r$"> from a 
central atom:
<BR>
<DIV ALIGN="RIGHT">

<!-- MATH
 \begin{equation}
n\left(r\right) = \int_0^r\int_0^{\pi}\int_0^{2\pi} g\left(r^\prime\right) \left(r^\prime\right)^2\sin\theta dr^\prime d\theta d\phi =  4\pi\rho\int_0^r \left(r^\prime\right)^2g\left(r^\prime\right)dr^\prime
\end{equation}
 -->
<TABLE WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE"><TD ALIGN="CENTER" NOWRAP><A NAME="eq:md:ungr"></A><IMG
 WIDTH="463" HEIGHT="46" BORDER="0"
 SRC="img461.png"
 ALT="\begin{displaymath}
n\left(r\right) = \int_0^r\int_0^{\pi}\int_0^{2\pi} g\left(r...
...int_0^r \left(r^\prime\right)^2g\left(r^\prime\right)dr^\prime
\end{displaymath}"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(152)</TD></TR>
</TABLE>
<BR CLEAR="ALL"></DIV><P></P>
In principle, any quantity that can be written as a sum of pairwise
terms (such as potential energy and pressure) can be written as an
integral over <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$">.  For example, the total potential can be
computed by ``averaging'' the pairwise potential <IMG
 WIDTH="33" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img462.png"
 ALT="$u(r)$"> over <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$">:
<BR>
<DIV ALIGN="CENTER">

<!-- MATH
 \begin{eqnarray}
\mathscr{U}/N & = & \frac{1}{2}\rho\int_0^\infty\int_0^{\pi}\int_0^{2\pi} u(r) g(r) r^2\sin\theta d r d \theta d \phi\\
& = & 2\pi\int_0^\infty r^2 u(r)g(r)dr
\end{eqnarray}
 -->
<TABLE ALIGN="CENTER" CELLPADDING="0" WIDTH="100%">
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT"><IMG
 WIDTH="37" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img463.png"
 ALT="$\displaystyle \mathscr{U}/N$"></TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img106.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="274" HEIGHT="58" ALIGN="MIDDLE" BORDER="0"
 SRC="img464.png"
 ALT="$\displaystyle \frac{1}{2}\rho\int_0^\infty\int_0^{\pi}\int_0^{2\pi} u(r) g(r) r^2\sin\theta d r d \theta d \phi$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(153)</TD></TR>
<TR VALIGN="MIDDLE"><TD NOWRAP ALIGN="RIGHT">&nbsp;</TD>
<TD ALIGN="CENTER" NOWRAP><IMG
 WIDTH="16" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img106.png"
 ALT="$\textstyle =$"></TD>
<TD ALIGN="LEFT" NOWRAP><IMG
 WIDTH="144" HEIGHT="53" ALIGN="MIDDLE" BORDER="0"
 SRC="img465.png"
 ALT="$\displaystyle 2\pi\int_0^\infty r^2 u(r)g(r)dr$"></TD>
<TD WIDTH=10 ALIGN="RIGHT">
(154)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
Theories of the liquid state have as a primary goal the <EM>prediction</EM> of <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$"> given intermolecular potentials and molecular
structure.  MD simulation is therefore a useful complement to
theoretical investigations.  Let us now consider <EM>how</EM> to compute
<IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$"> from an MD simulation of the Lennard-Jones liquid.

<P>
The procedure we will follow will be to write a second program (a
``postprocessing code'') which will read in the configuration files
(``samples'') produced by the simulation, <EM>mdlj.c</EM>.  Algorithm 7
on p. 86 of F&amp;S demonstrates a method to compute <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$"> by sampling
the current configuration, presumably in a simulation program,
although this algorithm tranfers perfectly into a post-processing
code.

<P>
The general structure of a <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$"> post-processing code could look
like this:

<OL>
<LI>Determine limits: start, stop, and step
</LI>
<LI>Initialize histogram.
</LI>
<LI>For each configuration:

<OL>
<LI>Read it in
</LI>
<LI>Visit all unique pairs of particles, and update histogram for each visit
if applicable
</LI>
</OL>
</LI>
<LI>Normalize histogram and output.
</LI>
<LI>End.
</LI>
</OL>

<P>
We will consider a code, <A NAME="tex2html17"
  HREF="codes/rdf.c"><EM>rdf.c</EM></A>, that
implements this algorithm for computing <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$">, but first we present a
brief argument for post-processing vs on-the-fly processing for
computing quantities such as <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$">.  For demonstration purposes, it
is arguably simpler to drop in a <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$">-histogram update sampling
function into an existing MD simulation program to enable computation
of <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$"> <EM>during</EM> a simulation, compared to writing a wholly
separate program.  After all, it nominally involves less coding.  The
counterargument is that, once you have a working (and eventually
optimized) MD simulation code, one should be wary of modifying it.
The purpose of the MD simulation is to produce samples.  One can
produce samples once, and use any number of post-processing codes to
extract useful information.  The counterargument becomes stronger when
one considers that, for particularly large-scale simulations, it is
simply not convenient to re-run an entire simulation when one
discovers a slight bug in the sampling routines.  The price one
pays is that one needs the disk space to store configurations.

<P>
As shown earlier, one MD simulation of 108 particles out to 600,000
time steps, storing configurations every 1,000 time steps, requires
less than 5 MB.  This is an insignificant price.  Given that we <EM>know</EM> that the MD simulation works correctly, it is sensible to <EM>leave it alone</EM> and write a quick, simple post-processing code to read
in these samples and compute <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$">.

<P>
The code <A NAME="tex2html18"
  HREF="codes/rdf.c"><EM>rdf.c</EM></A>
is a C-code implementation
of just such a post-processing code.  Below is the function that conducts
the sample:
<PRE>
 0 void update_hist ( double * rx, double * ry, double * rz, 
 1		   int N, double L, double rc2, double dr, int * H ) {
 2   int i,j,bin;
 3   double dx, dy, dz, r2, hL = L/2;
 4
 5   for (i=0;i&lt;(N-1);i++) {
 6     for (j=i+1;j&lt;N;j++) {
 7       dx  = rx[i]-rx[j];
 8       dy  = ry[i]-ry[j];
 9       dz  = rz[i]-rz[j];
10       if (dx&gt;hL)       dx-=L;
11       else if (dx&lt;-hL) dx+=L;
12       if (dy&gt;hL)       dy-=L;
13       else if (dy&lt;-hL) dy+=L;
14       if (dz&gt;hL)       dz-=L;
15       else if (dz&lt;-hL) dz+=L;
16       r2 = dx*dx + dy*dy + dz*dz;
17       if (r2&lt;rc2) {
18	   bin=(int)(sqrt(r2)/dr);
19	   H[bin]+=2;
20       }
21     }
22   }
23 }
</PRE>
<TT>H</TT> is the histogram.  One can see that the bin value is computed
on line 18 by first dividing the actual distance between members of
the pair by the <EM>resolution</EM> of the histogram, <IMG
 WIDTH="19" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img205.png"
 ALT="$\delta r$">.  This
resolution can be specified on the command-line when <EM>rdf.c</EM> is
executed.  Also notice that the histogram is updated by 2, which
reflects the fact that either of the two particles in the pair can be
placed at the origin.  Also notice that lines 10-15 implement the
minimum image convention.

<P>
Now, let's execute <EM>rdf</EM> in a directory we had previously run
the MD simulation.  That directory contains the 600 snapshots.
<PRE>
cfa@abrams01:/home/cfa/dxu/che800-002/md_cs2/run1&gt;../../rdf -fnf %i.xyz -for 10000,590000,1000 -rc 2.501 -dr 0.02 &gt; rdf
</PRE>
This <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$"> computation begins with the snapshot at timestep 10,000,
and includes every snapshot between 10,000 and 590,000.  A cutoff of
2.501 is used, and a bin size of 0.02 <IMG
 WIDTH="14" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img7.png"
 ALT="$\sigma $">.  Output is redirected
to the file <TT>rdf</TT>.  If we look at <TT>rdf</TT>, we see
<PRE>
cfa@abrams01:/home/cfa/dxu/che800-002/md_cs2/run1&gt;more rdf
0.0000 0.0000
0.0200 0.0000
0.0400 0.0000
0.0600 0.0000
0.0800 0.0000
0.1000 0.0000
0.1200 0.0000
0.1400 0.0000
0.1600 0.0000
0.1800 0.0000
0.2000 0.0000
0.2200 0.0000
0.2400 0.0000
0.2600 0.0000
0.2800 0.0000
0.3000 0.0000
0.3200 0.0000
0.3400 0.0000
0.3600 0.0000
0.3800 0.0000
0.4000 0.0000
0.4200 0.0000
^C
</PRE>
Of course, <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$"> doesn't become non-zero until about <IMG
 WIDTH="12" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img296.png"
 ALT="$r$"> = 1.  Below
is a gnuplot-generated figure of <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$">, averaged over the three
independent runs.

<P>
<TABLE CELLPADDING=3>
<TR><TD ALIGN="CENTER"><IMG
 WIDTH="360" HEIGHT="252" ALIGN="CENTER"
 SRC="grlj.gif"
 ALT="portrait"></TD>
</TR>
<TR><TD ALIGN="CENTER"><TABLE  WIDTH="454">
<TR><TD>
<DIV ALIGN="CENTER">The radial distribution function of a Lennard-Jones
fluid as described in Case Study 4 in F&amp;S: <IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.png"
 ALT="$T$"> = 0.729, <IMG
 WIDTH="28" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$rho$"> =
0.8442, <IMG
 WIDTH="18" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img2.png"
 ALT="$N$"> = 108.  Data is an average over three independent
runs.&nbsp;<A NAME="tex2html15"
  HREF="#footmp3970"><SUP>1</SUP></A></DIV></TD></TR>
<TR ALIGN="LEFT">
<TD><DL>
<DD><A NAME="footmp3970"><SUP>1</SUP></A> This
graph was produced using gnuplot and a script found
<A NAME="tex2html16"
  HREF="gp/gpgr">here</A>.
</DD>
</DL></TD></TR>
</TABLE></TD>
</TR>
</TABLE>
Given that we now have a tabulated <IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img459.png"
 ALT="$g(r)$">, we can actually compute the
integral in Eq.&nbsp;<A HREF="#eq:md:ungr">152</A> to estimate <IMG
 WIDTH="37" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img466.png"
 ALT="$\mathscr{U}/N$"> as a consistency
check on our simulation results.  Using a homegrown code
<A NAME="tex2html19"
  HREF="codes/intg.c"><EM>intg.c</EM></A>, I obtain <!-- MATH
 $\mathscr{U}/N \sim
-4.458$
 -->
<IMG
 WIDTH="107" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img467.png"
 ALT="$\mathscr{U}/N \sim
-4.458$">, which compares well to the directly computed average of
<!-- MATH
 $\mathscr{U}/N \sim -4.4170$
 -->
<IMG
 WIDTH="115" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img468.png"
 ALT="$\mathscr{U}/N \sim -4.4170$">.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html423"
  HREF="node29.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html421"
  HREF="node21.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html415"
  HREF="node27.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html424"
  HREF="node29.html">Case Study 3: Dynamical</A>
<B> Up:</B> <A NAME="tex2html422"
  HREF="node21.html">Molecular Dynamics Simulation</A>
<B> Previous:</B> <A NAME="tex2html416"
  HREF="node27.html">The Code, mdlj.c</A>
<!--End of Navigation Panel-->
<ADDRESS>
cfa22@drexel.edu
</ADDRESS>
</BODY>
</HTML>
